<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Dstat.one - Professional Layer4 & Layer7 Dstats</title>

    <meta name="title" content="Dstat.one - Professional Layer4 & Layer7 Dstats" />
    <meta name="description" content="Simplified, private L4 and L7 Dstats with real-time graphs. Monitor your server performance with precision. Secure, fast, and reliable Dstat solutions for every use case." />
    <meta name="keywords" content="Dstat, Layer4, L4, L7, Layer7, dstat l4, dstat l7, dstat layer7, dstat layer4, Dstat Monitoring, Real-time Dstat, Server Stats, Network Monitoring, System Performance, DDoS Protection, Stress Testing, Resource Usage, Server Load, Traffic Analysis, vedbex, dstatspace, dstatst, dstatonline, dstatcc, dstatone, dstatcc, dstatlove, IP Stresser, IP Booter, Best IP Stresser, Free IP Stresser, Booter Service, Stresser Service, DDoS Booter, DDoS Stresser, Layer4 Booter, Layer7 Booter, DDoS Attack Tools, DDoS Testing, Network Stress Test, Server Stress Test, Booter Panel, Stresser Panel, DDoS-for-Hire, DDoS-as-a-Service, Booter Tools, Stresser Tools, IP Stresser Online, Booter Services, Stresser Services, DDoS Simulation, DDoS Protection Test, DDoS Mitigation, Booter Website, Stresser Website, Dstat监控, 实时Dstat, 服务器监控, 网络监控, 系统性能, DDoS防护, 压力测试, 资源使用, 服务器负载, 流量分析, 网络统计, 服务器状态, 性能优化, 数据中心监控, 服务器管理工具, 网络延迟测试, 带宽监控, 服务器安全, 实时数据分析, IP Stresser工具, 免费IP Stresser, Booter服务, DDoS攻击工具, 压力测试工具, 网络压力测试, DDoS防御测试, 服务器压力测试, DDoS压力测试, DStat监控工具, DStat命令, DStat教程, DStat安装, DStat使用, DStat插件, DStat文档, DStat示例, IP Stresser español, Booter servicios, Herramientas de estrés IP, Pruebas de DDoS, Servicios de Booter, Ataques DDoS, Protección DDoS, Pruebas de estrés de red, Monitoreo de servidores, Análisis de tráfico, Seguridad de red, Estrés de capa 4, Estrés de capa 7" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://dstat.one/" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://dstat.one/" />
    <meta property="og:title" content="Dstat.one - Professional Layer4 & Layer7 Dstats" />
    <meta property="og:description" content="Private L4 & L7 Dstats with powerful live graphs. Secure and effective monitoring for stress testing. Always online graphs for Dstats L4 & L7, we never disappoint." />
    <meta property="og:locale" content="en_US" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://dstat.one/" />
    <meta name="twitter:title" content="Dstat.one - Professional Layer4 & Layer7 Dstats" />
    <meta name="twitter:description" content="Advanced L4 & L7 Dstat services with real-time stats, stress testing, and attack analysis. Monitor and optimize your infrastructure with ease." />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script async data-id="101486735" src="//static.getclicky.com/js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --main-padding: 1rem;
            --content-bg: #1a1d23;
            --dropdown-bg: #1a1d23;
            --dropdown-hover: #23272e;
            --topbar-bg-color: #1a1d23;
            --topbar-text-color: #fff;
            --primary-color: #4a6fa5;
            --secondary-color: #8b9bb4;
            --accent-color: #6d8cc5;
            --success-color: #4caf50;
            --danger-color: #f44336;
            --card-bg: #22272e;
            --border-color: #2d3746;
        }
        
        body {
            background-color: #14161c;
            font-family: 'Space Grotesk', sans-serif;
            color: #e0e0e0;
        }
        
        .page-container {
            padding-left: var(--main-padding);
            padding-right: var(--main-padding);
        }

        .logo-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0.75rem 0 2.5px 0;
            position: relative;
        }

        .logo-bar a {
            text-decoration: none;
        }

        .left-icons, .right-icons {
            display: flex;
            align-items: center;
            gap: 7.5px;
            flex: 1;
        }

        .right-icons {
            justify-content: flex-end;
        }

        .logo {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 2rem;
            color: white;
            letter-spacing: -0.5px;
            text-align: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            cursor: pointer;
            width: max-content;
        }

        .icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 767.98px) {
            .logo {
                position: static;
                transform: none;
                order: 1;
                flex-grow: 1;
                text-align: center;
            }
            
            .left-icons {
                order: 0;
            }
            
            .right-icons {
                order: 2;
            }
            
            .left-icons, .right-icons {
                flex: initial;
            }
        }
        
        .topbar {
            background-color: var(--topbar-bg-color);
            color: white;
            padding: 4.5px;
            margin: 0 0 2.5px 0;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }
        
        .chart-container {
            background-color: var(--content-bg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            padding: 10px;
            margin-top: 15px;
            position: relative;
            border: 1px solid var(--border-color);
        }
        
        .icon {
            font-size: 1.5rem;
            color: #fff;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: var(--dropdown-bg);
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: block;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            padding: 0.5rem 0;
            min-width: 150px;
            z-index: 1000;
            border: 1px solid var(--border-color);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown:hover .dropdown-menu,
        .dropdown.show .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item {
            color: #e0e0e0;
            transition: all 0.2s ease;
            position: relative;
            font-size: 0.95rem;
        }
        
        .dropdown-item:hover {
            background-color: var(--dropdown-hover);
            color: white;
            padding-left: 25px;
        }
        
        .dropdown-item:hover::after {
            content: "→";
            position: absolute;
            right: 15px;
            color: var(--accent-color);
        }
        
        .dropdown-header {
            color: var(--secondary-color);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0.5rem 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .nav-link.dropdown-toggle::after {
            display: inline-block;
            margin-left: 0.5em;
            vertical-align: 0.255em;
            content: "";
            border-top: 0.35em solid;
            border-right: 0.35em solid transparent;
            border-bottom: 0;
            border-left: 0.35em solid transparent;
            transition: transform 0.3s ease;
        }
        
        .dropdown:hover .nav-link.dropdown-toggle::after,
        .show .nav-link.dropdown-toggle::after {
            transform: rotate(-180deg);
        }
        
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
        }
        
        .nav-link:hover {
            color: #fff !important;
        }
        
        .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--accent-color);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::before {
            width: 100%;
        }
        
        .nav-link.active::before {
            width: 100%;
            background-color: var(--primary-color);
        }

        .rounded-flag {
            display: inline-block;
            border-radius: 25%;
            overflow: hidden;
        }

        #myChart {
            position: relative;
            z-index: 2;
            background: transparent;
        }

        #text {
            z-index: 3;
        }
        
        #chart-background {
            margin-top: 70px;
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://dstat.one/background.png');
            background-size: cover;
            background-position: center;
            opacity: 0.25;
            z-index: 1;
        }

        .newsbar {
            background-color: var(--content-bg);
            color: var(--topbar-text-color);
            padding: 7.5px 0 7.5px 0;
            border-radius: 4px;
            margin-top: 15px;
            text-align: center;
            width: 100%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }

        .newsbar a {
            color: var(--secondary-color);
        }

        .newsbar-content {
            font-weight: bold;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        @media (max-width: 767.98px) {
            .topbar .me-3[href*="t.me/forenix56"] {
                display: none;
            }
        }

        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .notification {
            min-width: 50px;
            padding: 15px;
            border-radius: 4px;
            color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.failed {
            background-color: var(--danger-color);
        }

        .dstat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .dstat-category {
            margin-bottom: 25px;
        }

        .dstat-category h3 {
            color: #cfdbe2;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dstat-btn {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 12px 15px;
            background-color: var(--card-bg);
            color: #e0e0e0;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            text-align: left;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            gap: 12px;
        }

        .dstat-btn:hover {
            background-color: #2a3038;
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .dstat-flag {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a2a3a;
        }

        .dstat-flag .fi {
            font-size: 1.2rem;
            line-height: 1;
        }

        .dstat-btn-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .dstat-name {
            font-weight: 500;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dstat-type {
            font-size: 0.75rem;
            color: var(--secondary-color);
        }

        .dstat-badge {
            flex-shrink: 0;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-left: auto;
        }

        .dstat-btn:hover .dstat-badge {
            background-color: var(--card-bg);
            border-color: var(--accent-color);
        }

        .dstat-btn::after {
            content: "→";
            position: absolute;
            right: 15px;
            color: var(--accent-color);
            opacity: 0;
            transform: translateX(-5px);
            transition: all 0.3s ease;
        }

        .dstat-btn:hover::after {
            opacity: 1;
            transform: translateX(0);
        }

        .dstat-btn:hover .dstat-badge {
            margin-right: 20px;
        }

        .banner-container {
            background-color: var(--content-bg);
            border-radius: 4px;
            padding: 5px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }
        
        .banner-row {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: space-between;
        }
        
        .banner {
            flex: 1;
            min-width: 200px;
        }
        
        .banner img {
            width: 100%;
            max-height: 70px;
            min-height: 70px;
            border-radius: 6px;
        }

        .loading-topbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: transparent;
            z-index: 9999;
            overflow: hidden;
            display: none;
        }

        .loading-topbar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            animation: loadingAnimation 2s linear infinite;
            transform: translateX(-100%);
        }

        .loading-topbar.active {
            display: block;
        }

        @keyframes loadingAnimation {
            0% {
                transform: translateX(-100%);
            }
            50% {
                transform: translateX(0%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        @media (max-width: 768px) {
            .dstat-grid {
                grid-template-columns: 1fr;
            }

            .banner-row {
                flex-direction: column;
            }
            
            .banner {
                min-width: calc(50% - 15px);
            }
        }

        /* New styles for the category header with add button */
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-title {
            color: #cfdbe2;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-grow: 1;
        }

        .add-dstat-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            border: 1px solid var(--border-color);
            color: #e0e0e0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            text-decoration: none;
            transition: all 0.3s ease;
            white-space: nowrap;
            margin-left: 15px;
        }

        .add-dstat-btn:hover {
            background: linear-gradient(45deg, var(--accent-color), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(77, 123, 205, 0.3);
        }

        /* Popup Banner Styles */
        .popup-banner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .popup-banner-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .popup-banner {
            background-color: var(--content-bg);
            border-radius: 4px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
        }
        
        .popup-banner-overlay.active .popup-banner {
            transform: translateY(0);
        }
        
        .popup-banner-icon {
            text-align: center;
            font-size: 2.5rem;
            color: var(--accent-color);
            margin-bottom: 15px;
        }
        
        .popup-banner-title {
            color: white;
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .popup-banner-content {
            color: var(--secondary-color);
            margin-bottom: 20px;
            line-height: 1.5;
            text-align: center;
            display: grid;
            grid-template-columns: 1fr;
            gap: 5px;
        }
        
        .popup-banner-button {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .popup-banner-button:hover {
            background: linear-gradient(45deg, var(--accent-color), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(77, 123, 205, 0.3);
        }
        
        .popup-banner-dismiss {
            display: block;
            text-align: center;
            margin-top: 15px;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .popup-banner-dismiss:hover {
            color: #b6c6d3;
            text-decoration: underline;
        }
        
        /* Last updated indicator */
        .last-updated {
            font-size: 0.8rem;
            color: var(--secondary-color);
            text-align: right;
            margin-top: 10px;
        }
        
        /* Error message styling */
        .error-message {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--danger-color);
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        /* Search bar styles */
        .search-container {
            margin-bottom: 20px;
            position: relative;
        }

        /* Search bar auf Chart-Seiten ausblenden */
        #homepage-content .search-container {
            display: block;
        }

        #homepage-content[style*="display: none"] .search-container,
        #search-results-content .search-container {
            display: none;
        }

        #searchChart {
            width: 100%;
            max-height: 475px;
            min-height: 375px;
        }
        
        #searchInput {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--card-bg);
            color: #e0e0e0;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        #searchInput:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(109, 140, 197, 0.2);
        }
        
        #searchInput::placeholder {
            color: var(--secondary-color);
        }
        
        .search-results-info {
            margin: 10px 0;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }
        
        .no-results {
            text-align: center;
            padding: 30px;
            color: var(--secondary-color);
        }
        
        .no-results i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--border-color);
        }

        /* Network container styles for search results */
        .network-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .network-sidebar {
            width: 400px;
            background-color: var(--content-bg);
            border-radius: 4px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }
        
        .network-main {
            flex: 1;
            background-color: var(--content-bg);
            border-radius: 4px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }
        
        .devices-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .devices-table th, 
        .devices-table td {
            padding: 12px 15px;
            text-align: left;
            color: #fff;
            border-bottom: 1px solid var(--border-color);
        }
        
        .devices-table th {
            background-color: var(--card-bg);
            position: sticky;
            top: 0;
        }
        
        .devices-table tr:hover {
            background-color: var(--dropdown-hover);
            cursor: pointer;
        }
        
        .devices-table .selected {
            background-color: var(--dropdown-hover);
        }
        
        .device-info {
            margin-top: 20px;
            background-color: var(--card-bg);
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }
        
        .info-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: bold;
            width: 120px;
            color: var(--secondary-color);
        }
        
        .info-value {
            flex: 1;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .back-to-home {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            border: 1px solid var(--border-color);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .back-to-home:hover {
            background: linear-gradient(45deg, var(--accent-color), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(77, 123, 205, 0.3);
            color: white;
        }

        @media (max-width: 767.98px) {
            .network-container {
                flex-direction: column;
            }
            
            .network-sidebar {
                width: 100%;
                margin-bottom: 15px;
            }
            
            .network-main {
                width: 100%;
            }
            
            .chart-wrapper {
                height: 300px;
            }
        }

        .search-results-container {
            margin-top: 20px;
        }
        
        .no-results-message {
            text-align: center;
            padding: 30px;
            color: var(--secondary-color);
            background-color: var(--card-bg);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        
        .no-results-message i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--border-color);
        }
        
        .search-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .search-result-item {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 12px 15px;
            background-color: var(--card-bg);
            color: #e0e0e0;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            text-align: left;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            gap: 12px;
            cursor: pointer;
        }
        
        .search-result-item:hover {
            background-color: #2a3038;
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        
        .search-result-item.selected {
            background-color: var(--dropdown-hover);
            border-color: var(--accent-color);
        }
        
        .search-result-flag {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a2a3a;
        }
        
        .search-result-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        
        .search-result-name {
            font-weight: 500;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .search-result-details {
            font-size: 0.75rem;
            color: var(--secondary-color);
        }
        
        .search-result-badge {
            flex-shrink: 0;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .search-result-item:hover .search-result-badge {
            background-color: var(--card-bg);
            border-color: var(--accent-color);
        }
        
        .search-result-item::after {
            content: "→";
            position: absolute;
            right: 15px;
            color: var(--accent-color);
            opacity: 0;
            transform: translateX(-5px);
            transition: all 0.3s ease;
        }
        
        .search-result-item:hover::after {
            opacity: 1;
            transform: translateX(0);
        }
        
        .search-result-item:hover .search-result-badge {
            margin-right: 20px;
        }
        
        .search-chart-container {
            background-color: var(--content-bg);
            border-radius: 4px;
            padding: 15px;
            display: none;
            position: relative;
        }

        .search-chart-container.active {
            display: block;
        }
        
        .search-chart-title {
            color: white;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .search-chart-wrapper {
            position: relative;
            height: 475px;
            min-height: 375px;
        }
        
        .back-to-search {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            border: 1px solid var(--border-color);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-to-search:hover {
            background: linear-gradient(45deg, var(--accent-color), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(77, 123, 205, 0.3);
            color: white;
        }
    </style>
</head>
<body>

    <div class="popup-banner-overlay" id="popupBanner">
        <div class="popup-banner">
            <div class="popup-banner-content">
                <a href="https://silencestress.st/?r=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/silencestresser.gif" alt="Banner 1"></a>
                <a href="https://return.st" target="_blank" class="banner"><img src="https://dstat.one/banners/return.gif" alt="Banner 2"></a>
                <a href="https://goliathstress.st/?=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/goliahstress.gif" alt="Banner 3"></a>
                <a href="https://t.me/thorccsolution" target="_blank" class="banner"><img src="https://dstat.one/banners/thorcc.gif" alt="Banner 4"></a>
            </div>
            <span class="popup-banner-dismiss" id="dismissBanner">Don't show this again</span>
        </div>
    </div>

    <div class="loading-topbar" id="loadingTopbar"></div>

    <div class="notification-container" id="notificationContainer"></div>

    <div class="page-container">
        <div class="logo-bar">
            <div class="left-icons">
                <a href="https://uptime.dstat.one" target="_blank" class="icon">
                    <i class="fa-solid fa-signal fa-2xs" title="Uptime"></i>
                </a>
                <a class="icon" id="zoomBtn">
                    <i class="fa-solid fa-up-right-and-down-left-from-center fa-2xs" title="Zoom"></i>
                </a>
            </div>
            <div class="logo" data-translate="dstatone"></div>
            <div class="right-icons">
                <div class="dropdown icon">
                    <a class="nav-link dropdown-toggle text-white" id="languageDropdown" style="cursor: pointer;font-size: 15px;" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-language me-1"></i> <span id="language"></span>
                    </a>
                    <ul class="dropdown-menu" style="min-width: 150px;">
                        <li><a class="dropdown-item" style="cursor: pointer;" onclick="changeLanguage(`en`);"><span class="fi fi-gb me-1"></span> English</a></li>
                        <li><a class="dropdown-item" style="cursor: pointer;"  onclick="changeLanguage(`cn`);"><span class="fi fi-cn me-1"></span> Chinese</a></li>
                        <li><a class="dropdown-item" style="cursor: pointer;"  onclick="changeLanguage(`es`);"><span class="fi fi-es me-1"></span> Spanish</a></li>
                    </ul>
                </div>
                <a href="https://t.me/kaesekueche" target="_blank" class="icon">
                    <i class="fa-brands fa-telegram fa-xs" title="Telegram"></i>
                </a>
            </div>
        </div>

        <div class="topbar">
            <div class="d-flex justify-content-between align-items-center">
                <nav>
                    <ul class="nav">
                        <li class="nav-item"><a onclick="navigateTo('/')" style="cursor: pointer;" class="nav-link text-white" id="home"><i class="fa-solid fa-couch"></i> <c data-translate="home"></c></a></li>
                        <li class="nav-item"><a onclick="navigateTo('/stressers')" style="cursor: pointer;" class="nav-link text-white"><i class="fa-solid fa-dragon"></i> <c data-translate="top stressers"></c></a></li>
                        
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-white" id="l4" style="cursor: pointer;"  role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa-solid fa-chart-line"></i> <c data-translate="layer4"></c>
                            </a>
                            <ul class="dropdown-menu" id="layer4">
                            </ul>
                        </li>
                        
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-white" id="l7" style="cursor: pointer;" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa-solid fa-chart-line"></i> <c data-translate="layer7"></c>
                            </a>
                            <ul class="dropdown-menu" id="layer7">
                            </ul>
                        </li>
                    </ul>
                </nav>
                <a class="me-3" href="https://t.me/forenix56" target="_blank" style="text-decoration: none;color:#e0e0e0;" data-translate="support"></a>
            </div>
        </div>

        <div class="banner-container">
            <div class="banner-row">
                <a href="https://vacstresser.ru/?r=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/vacstresser.gif" alt="Banner 1"></a>
                <a href="https://silencestress.st/?r=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/silencestresser.gif" alt="Banner 2"></a>
                <a href="https://goliathstress.st/?=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/goliahstress.gif" alt="Banner 3"></a>
                <a href="https://dumpstress.su/?r=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/dumpcord.gif" alt="Banner 4"></a>
            </div>
        </div>

        <div class="newsbar">
            <div class="newsbar-content" data-translate="news"></div>
        </div>

         <div class="chart-container">
            <div style="padding:5px;">
                <div class="search-container" id="searchContainer">
                    <input type="text" id="searchInput" placeholder="Search ISPs, ASNs or Gbps..">
                </div>
                <div class="search-results-info" id="searchResultsInfo" style="display: none;"></div>
                
                <div id="homepage-content">
                    <center id="text"></center>
                    <div id="chart-background"></div>
                    <div id="dstats-container"></div>
                    <canvas id="myChart" style="width:100%;max-height: 475px;min-height: 375px;display:none;"></canvas>
                    <div class="last-updated" id="lastUpdated"></div>
                </div>

                <div id="search-results-content" style="display: none;">
                    <div class="search-navigation" id="searchnavigationresult">
                        <a href="javascript:void(0)" class="nav-item" onclick="showHomepage()">
                            <i class="fa-solid fa-house"></i> Homepage
                        </a>
                        <span class="nav-divider">/</span>
                        <span class="nav-item disabled">
                            <i class="fa-solid fa-search"></i> Search Results
                        </span>
                    </div>
                    
                    <div class="search-results-container" id="searchResultsContainer">
                    </div>
                    
                    <div class="search-chart-container" id="searchChartContainer">
                        <div class="search-chart-title" id="searchChartTitle"></div>
                        <div class="search-chart-wrapper">
                            <canvas id="searchChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="banner-container">
            <div class="banner-row">
                <a href="https://csters.to/?r=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/csters.gif" alt="Banner 5"></a>
                <a href="https://fluxstress.to/register?ref=5bf9e92467ef0" target="_blank" class="banner"><img src="https://dstat.one/banners/fluxstress.gif" alt="Banner 6"></a>
                <a href="https://ipstress.st/?ref=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/ipstress.gif" alt="Banner 7"></a>
                <a href="https://satellitestresser.st/?r=dstatone" target="_blank" class="banner"><img src="https://dstat.one/banners/satellitestresser.gif" alt="Banner 8"></a>
            </div>
        </div>
        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentLang = localStorage.getItem('dstat-language') || 'en';
        let allDstats = [];
        let chart = null;
        let refreshInterval = null;
        let searchDebounceTimer = null;
        let currentSearchTerm = '';
        let searchResults = [];
        let selectedDstat = null;
        let searchChart = null;

        const translations = {
            en: {
                "dstatone": `dstat<span style="color: var(--accent-color);">.one</span>`,
                "home": "Home",
                "top stressers": "Top Stressers",
                "layer4": "Layer4",
                "layer7": "Layer7",
                "l4dstats": "Layer4 Dstats",
                "l7dstats": "Layer7 Dstats",
                "search": "Search",
                "support": "Support",
                "news": `<i class="fa-brands fa-firefox" style="color:orange"></i> Use all our dstats now on <a href="https://t.me/lets_count_bot" target="_blank">Let's Count</a> via Telegram! Or join our Community directly via <a href="https://t.me/kaesekueche" target="_blank">@kaesekueche</a>`,
                "language": "Language",
                "unprotected": "Unprotected",
                "protected": "Protected",
                "url": "URL",
                "totalbandwidth": "Total Bandwidth In",
                "totalpackets": "Total Packets In",
                "totalrequests": "Total Requests",
                "activeconns": "Active Connections",
                "copied": "Copied to clipboard!",
                "all_dstats": "All Dstats",
                "add_your_dstat": "Add Your Dstat",
                "last_updated": "Last updated:",
                "error_loading": "Error loading data. Please try again.",
                "search_placeholder": "Search ISPs, ASNs or Gbps..",
                "search_results": "Search Results",
                "no_results": "No dstats found matching your search",
                "showing_results": "Found {count} matching dstats",
                "ip address": "IP Address",
                "isp": "ISP",
                "bandwidth": "Bandwidth"
            },
            cn: {
                "dstatone": `dstat<span style="color: var(--accent-color);">.一</span>`,
                "home": "家",
                "top stressers": "最令人紧张的因素",
                "layer4": "层4",
                "layer7": "层7",
                "l4dstats": "层4 Dstats",
                "l7dstats": "层7 Dstats",
                "search": "搜索",
                "support": "支持",
                "news": `<i class="fa-brands fa-firefox" style="color:orange"></i> 加入我们 <a href="https://t.me/kaesekueche" target="_blank">电报群</a> 宣传您的业务! 我们回来了并且我们会留下来!`,
                "language": "语言",
                "unprotected": "无保护",
                "protected": "受保护",
                "url": "网址",
                "totalbandwidth": "总带宽",
                "totalpackets": "总数据包",
                "totalrequests": "总请求数",
                "activeconns": "主动连接",
                "copied": "复制到剪贴板!",
                "all_dstats": "所有 Dstats",
                "add_your_dstat": "添加您的 Dstat",
                "last_updated": "最后更新:",
                "error_loading": "加载数据时出错。请重试。",
                "search_placeholder": "搜索 ISP、ASN 或带宽..",
                "search_results": "搜索结果",
                "no_results": "未找到匹配的 dstats",
                "showing_results": "找到 {count} 个匹配的 dstats",
                "ip address": "IP 地址",
                "isp": "ISP",
                "bandwidth": "带宽"
            },
            "es": {
                "dstatone": `dstat<span style="color: var(--accent-color);">.one</span>`,
                "home": "Menú",
                "top stressers": "Top Stressers",
                "layer4": "Capa4",
                "layer7": "Capa7",
                "l4dstats": "Capa4 Dstats",
                "l7dstats": "Capa7 Dstats",
                "search": "Buscar",
                "support": "Soporte",
                "news": `<i class="fa-brands fa-firefox" style="color:orange"></i> Unete a <a href="https://t.me/kaesekueche" target="_blank">Grupo de Telegram</a> & promociona tu negocio! Conecta con nosotros, estamos de vuelta y vamos to quedarnos!`,
                "language": "Idioma",
                "unprotected": "Desprotegido",
                "protected": "Protegido",
                "url": "URL",
                "totalbandwidth": "Total de Banda RX",
                "totalpackets": "Total de Paquetes RX",
                "totalrequests": "Peticiones totales",
                "activeconns": "Conexiones activas",
                "copied": "Copiado al portapapeles!",
                "ip address": "Dirección IP",
                "isp": "ISP",
                "bandwidth": "Banda",
                "all_dstats": "Todos los Dstats",
                "add_your_dstat": "Añade Tu Dstat",
                "last_updated": "Última actualización:",
                "error_loading": "Error al cargar los datos. Por favor, inténtalo de nuevo.",
                "search_placeholder": "Buscar ISP, ASN o ancho de banda..",
                "search_results": "Resultados de búsqueda",
                "no_results": "No se encontraron dstats que coincidan con tu búsqueda",
                "showing_results": "Se encontraron {count} dstats coincidentes"
            }
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Show loading animation immediately when page starts loading
            showLoading(true);
            
            initializeLanguage();
            setupEventListeners();
            loadDstats();
            updateLastUpdated();
            
            // Set up auto-refresh every 30 seconds
            refreshInterval = setInterval(refreshData, 30000);
            
            // Hide loading when window is fully loaded
            window.addEventListener('load', function() {
                setTimeout(function() {
                    showLoading(false);
                }, 500);
            });
        });

        function initializeLanguage() {
            // Set language based on localStorage
            if (currentLang === "es") {
                document.getElementById("language").innerText = `Spanish`;
            } else if (currentLang === "cn") {
                document.getElementById("language").innerText = `Chinese`;
            } else {
                document.getElementById("language").innerText = `English`;
                currentLang = 'en';
            }
            
            applyTranslations();
        }

        function setupEventListeners() {
            // Zoom functionality
            document.getElementById('zoomBtn').addEventListener('click', function() {
                document.body.classList.toggle('zoomed');
                showNotification("Zoom " + (document.body.classList.contains('zoomed') ? "enabled" : "disabled"), "success");
            });
            
            // Popup banner
            setupPopupBanner();
            
            // Search functionality
            setupSearch();
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchDebounceTimer);
                currentSearchTerm = this.value.trim();
                
                searchDebounceTimer = setTimeout(() => {
                    performSearch(currentSearchTerm);
                }, 300);
            });
            
            // Set placeholder text
            searchInput.placeholder = translations[currentLang].search_placeholder;
        }

        function performSearch(searchTerm) {
            const resultsInfo = document.getElementById('searchResultsInfo');
            
            if (!searchTerm) {
                // If search is empty, show all dstats normally
                resultsInfo.style.display = 'none';
                showHomepage();
                return;
            }
            
            showLoading(true);
            
            // Use the /all endpoint with search
            fetch(`https://api.dstat.one/all?page=1&search=${encodeURIComponent(searchTerm)}`)
                .then(response => response.json())
                .then(data => {
                    displaySearchResults(data, searchTerm);
                    showLoading(false);
                })
                .catch(error => {
                    console.error('Search error:', error);
                    showNotification("Error searching dstats", "failed");
                    showLoading(false);
                });
        }

        function displaySearchResults(data, searchTerm) {
            const resultsInfo = document.getElementById('searchResultsInfo');
            const resultsContainer = document.getElementById('searchResultsContainer');
            
            if (!data || !data.data || Object.keys(data.data).length === 0) {
                resultsInfo.style.display = 'block';
                resultsInfo.innerHTML = translations[currentLang].no_results;
                
                // Show no results message
                resultsContainer.innerHTML = `
                    <div class="no-results-message">
                        <i class="fa-solid fa-search"></i>
                        <h4>No dstats found</h4>
                        <p>There are currently no dstats with that name, ASN, or bandwidth amount.</p>
                        <p>Try searching with different terms or browse our available dstats.</p>
                    </div>
                `;
                
                showSearchResults();
                return;
            }
            
            // Convert the data object to array
            searchResults = Object.entries(data.data).map(([ip, details]) => ({
                ip,
                ...details,
                asn: `AS${details.asn}`,
                bandwidth: details.bandwidth || 0
            }));
            
            resultsInfo.style.display = 'block';
            resultsInfo.innerHTML = translations[currentLang].showing_results.replace('{count}', searchResults.length);
            
            // Show search results layout
            showSearchResults();
            
            // Populate the search results
            populateSearchResults(searchResults);
        }

        function populateSearchResults(results) {
            const resultsContainer = document.getElementById('searchResultsContainer');
            resultsContainer.innerHTML = '';
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results-message">
                        <i class="fa-solid fa-search"></i>
                        <h4>No dstats found</h4>
                        <p>There are currently no dstats with that name, ASN, or bandwidth amount.</p>
                        <p>Try searching with different terms or browse our available dstats.</p>
                    </div>
                `;
                return;
            }
            
            const resultsGrid = document.createElement('div');
            resultsGrid.className = 'search-results-grid';
            
            results.forEach(dstat => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item';
                resultItem.dataset.ip = dstat.ip;
                
                const countryCode = dstat.country && dstat.country !== 'Unknown' ? 
                    dstat.country.toLowerCase() : 'us';
                
                resultItem.innerHTML = `
                    <div class="search-result-flag">
                        <span class="fi fi-${countryCode}"></span>
                    </div>
                    <div class="search-result-content">
                        <span class="search-result-name">${dstat.isp || 'Unknown ISP'}</span>
                        <span class="search-result-details">${dstat.ip} • ${dstat.asn}</span>
                    </div>
                    <span class="search-result-badge">${dstat.bandwidth || 0} Gbps</span>
                `;
                
                resultItem.addEventListener('click', () => selectDstatForChart(dstat, resultItem));
                
                resultsGrid.appendChild(resultItem);
            });
            
            resultsContainer.appendChild(resultsGrid);
        }

        // Update the selectDstatForChart function to reset the chart
        function selectDstatForChart(dstat, element) {
            selectedDstat = dstat;
            
            // Update selection in results
            document.querySelectorAll('.search-result-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // Hide the search results container
            const resultsContainer = document.getElementById('searchResultsContainer');
            resultsContainer.style.display = 'none';
            
            // Hide the search results info
            const resultsInfo = document.getElementById('searchResultsInfo');
            resultsInfo.style.display = 'none';
            
            // Show chart container
            const chartContainer = document.getElementById('searchChartContainer');
            const chartTitle = document.getElementById('searchChartTitle');
            
            chartTitle.innerHTML = `
            ${dstat.isp || 'Unknown ISP'}<br>
                    IP: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copyToClipboard('${dstat.ip}')">${dstat.ip}</a> 
                    <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copyToClipboard('${dstat.ip}')"></i>
                    • ASN: ${dstat.asn}
                    • Bandwidth: ${dstat.bandwidth || 0} Gbps
            `;
            
            chartContainer.classList.add('active');
            
            // Reset the chart data before loading new data
            resetSearchChart();
            
            // Initialize or update the chart
            if (!searchChart) {
                initializeSearchChart();
            }
            
            // Load chart data
            loadSearchChartData(dstat);
        }

        function resetSearchChart() {
            if (searchChart) {
                // Reset all datasets to empty arrays with 60 zeros
                searchChart.data.datasets[0].data = [];
                searchChart.data.datasets[1].data = [];
                searchChart.data.datasets[2].data = [];
                
                // Reset labels
                searchChart.data.labels = [];
                
                // Update the chart
                searchChart.update();
            }
        }

        function initializeSearchChart() {
            document.getElementById("searchnavigationresult").innerHTML = `<div class="search-navigation"><a class=nav-item href=javascript:void(0) onclick=showHomepage()><i class="fa-solid fa-house"></i> Homepage </a><span class=nav-divider>/</span> <a class=nav-item href=javascript:void(0) onclick=showSearchResults()><i class="fa-solid fa-search"></i> Search Results </a><span class=nav-divider>/</span> <span class="nav-item disabled"><i class="fa-solid fa-chart-line"></i> Chart View</span></div>`;
            const ctx = document.getElementById('searchChart').getContext('2d');
            searchChart = new Chart(ctx, {
                type: "line",
                labels: [], // Start with empty labels
                data: {
                    datasets: [{
                        label: translations[currentLang].totalbandwidth,
                        fill: true,
                        borderColor: '#6c757c',
                        tension: 0.05,
                    },
                    {
                        label: translations[currentLang].totalpackets,
                        fill: true,
                        borderColor: '#949fa8',
                        tension: 0.05,
                    },
                    {
                        label: translations[currentLang].activeconns,
                        fill: true,
                        tension: 0.05,
                        borderColor: '#c2cdd6',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        display: false
                    },
                    interaction: {
                        intersect: false
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (`${context.dataset.label}`.includes(translations[currentLang].totalbandwidth)) {
                                            label += convertToBestUnit(context.parsed.y);
                                        } else {
                                            label += formatNumber(context.parsed.y);
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value, index, values) {
                                    return convertToBestUnit(value);
                                },
                            },
                        },
                    }
                }
            });

            // Start updating chart data
            setInterval(() => {
                if (selectedDstat) {
                    loadSearchChartData(selectedDstat);
                }
            }, 1500);
        }

        function loadSearchChartData(dstat) {
            fetch('https://api.dstat.one/stats', {
                method: 'POST',
                body: JSON.stringify({
                    "ip": dstat.ip,
                    "port": 19999,
                    "type": "l4"
                }),
            }).then(async (response) => {
                var json = await response.json();
                if(searchChart.data.datasets[0].data.length >= 60) {
                    searchChart.data.datasets[0].data.shift();
                    searchChart.data.datasets[1].data.shift();
                    searchChart.data.datasets[2].data.shift();
                    searchChart.data.datasets[0].data.push(json.mbits || 0)
                    searchChart.data.datasets[1].data.push(json.pps || 0)
                    searchChart.data.datasets[2].data.push(json.conns || 0)
                    searchChart.update();
                } else {
                    searchChart.data.labels.push("")
                    searchChart.data.datasets[0].data.push(json.mbits || 0)
                    searchChart.data.datasets[1].data.push(json.pps || 0)
                    searchChart.data.datasets[2].data.push(json.conns || 0)
                    searchChart.update();
                }
            }).catch(error => {
                console.error('Error loading chart data:', error);
            });
        }

        function showHomepage() {
            document.getElementById('homepage-content').style.display = 'block';
            document.getElementById('search-results-content').style.display = 'none';
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResultsInfo').style.display = 'none';
            
            // Reset search state
            selectedDstat = null;
            const chartContainer = document.getElementById('searchChartContainer');
            chartContainer.classList.remove('active');
        }

        function showSearchResults() {
            document.getElementById('homepage-content').style.display = 'none';
            document.getElementById('search-results-content').style.display = 'block';

            // Hide the search input when viewing chart
            const searchInput = document.getElementById('searchInput');
            searchInput.style.display = 'block';
            
            // Show the search results container again
            const resultsContainer = document.getElementById('searchResultsContainer');
            resultsContainer.style.display = 'block';
            
            // Hide chart container
            const chartContainer = document.getElementById('searchChartContainer');
            chartContainer.classList.remove('active');
        }

        function formatDateTime(timestamp) {
            if (!timestamp) return "Unknown";
            
            const date = new Date(timestamp);
            return date.toLocaleString();
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            showNotification(translations[currentLang].copied, "success");
        }

        function setupPopupBanner() {
            const lastDismissed = localStorage.getItem('popupBannerDismissed');
            const oneDayInMs = 1 * 60 * 60 * 1000;

            if (!lastDismissed || (Date.now() - parseInt(lastDismissed)) > oneDayInMs) {
                setTimeout(function() {
                    const popupBanner = document.getElementById('popupBanner');
                    if (popupBanner) {
                        popupBanner.classList.add('active');
                        
                        popupBanner.addEventListener('click', function(e) {
                            if (e.target === this) {
                                localStorage.setItem('popupBannerDismissed', Date.now().toString());
                                closePopupBanner();
                            }
                        });
                    }
                }, 500);
            }
            
            const dismissButton = document.getElementById('dismissBanner');
            if (dismissButton) {
                dismissButton.addEventListener('click', function() {
                    closePopupBanner();
                    localStorage.setItem('popupBannerDismissed', Date.now().toString());
                });
            }
        }

        function closePopupBanner() {
            const popupBanner = document.getElementById('popupBanner');
            if (popupBanner) {
                popupBanner.classList.remove('active');
            }
        }

        function changeLanguage(lang) {
            localStorage.setItem('dstat-language', lang);
            currentLang = lang;
            applyTranslations();
            loadDstats(); // Reload dstats to update language in navigation
            updateLanguageDisplay();
        }

        function updateLanguageDisplay() {
            if (currentLang === "es") {
                document.getElementById("language").innerText = `Spanish`;
            } else if (currentLang === "cn") {
                document.getElementById("language").innerText = `Chinese`;
            } else {
                document.getElementById("language").innerText = `English`;
            }
        }

        function applyTranslations() {
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                el.innerHTML = translations[currentLang][key] || translations['en'][key];
            });
        }

        function navigateTo(path) {
            window.location.href = path;
        }

        function loadDstats() {
            fetch('https://api.dstat.one/list', {
                method: 'GET'
            }).then(async (response) => {
                if (response.status === 200) {
                    const json = await response.json();
                    allDstats = json;
                    populateNavigation(json);
                    populateDstatButtons(json);
                    
                    // If window is already loaded, hide loading
                    if (document.readyState === 'complete') {
                        setTimeout(() => {
                            showLoading(false);
                        }, 500);
                    }
                } else {
                    throw new Error('Failed to fetch data');
                }
            }).catch(error => {
                console.error('Error fetching data:', error);
                showError(translations[currentLang].error_loading);
                showLoading(false);
            });
        }

        function populateNavigation(data) {
            const layer4 = document.getElementById("layer4");
            const layer7 = document.getElementById("layer7");
            
            layer4.innerHTML = '';
            layer7.innerHTML = '';
            
            if(data['unprotected-l4']) {
                layer4.innerHTML += `<li><h6 class="dropdown-header">${translations[currentLang].unprotected}</h6></li>`;
                data['unprotected-l4'].forEach(item => {
                    layer4.innerHTML += `<li><a class="dropdown-item" href="/l4/` + item.name + `">` + item.nickname + ` <span class="badge me-2" style="border: 1px solid var(--border-color);">~` + formatValue("l4", item.amount) + `</span></a></li>`;
                });
            }
            
            if(data['protected-l4']) {
                layer4.innerHTML += `<li><h6 class="dropdown-header">${translations[currentLang].protected}</h6></li>`;
                data['protected-l4'].forEach(item => {
                    layer4.innerHTML += `<li><a class="dropdown-item" href="/l4/` + item.name + `">` + item.nickname + ` <span class="badge me-2" style="border: 1px solid var(--border-color);">~` + formatValue("l4", item.amount) + `</span></a></li>`;
                });
            }
            
            if(data['unprotected-l7']) {
                layer7.innerHTML += `<li><h6 class="dropdown-header">${translations[currentLang].unprotected}</h6></li>`;
                data['unprotected-l7'].forEach(item => {
                    layer7.innerHTML += `<li><a class="dropdown-item" href="/l7/` + item.name + `">` + item.nickname + ` <span class="badge me-2" style="border: 1px solid var(--border-color);">~` + formatValue("l7", item.amount) + `</span></a></li>`;
                });
            }
            
            if(data['protected-l7']) {
                layer7.innerHTML += `<li><h6 class="dropdown-header">${translations[currentLang].protected}</h6></li>`;
                data['protected-l7'].forEach(item => {
                    layer7.innerHTML += `<li><a class="dropdown-item" href="/l7/` + item.name + `">` + item.nickname + ` <span class="badge me-2" style="border: 1px solid var(--border-color);">~` + formatValue("l7", item.amount) + `</span></a></li>`;
                });
            }
        }

        function populateDstatButtons(data) {
            const container = document.getElementById('dstats-container');
            container.innerHTML = '';
            
            // Create L4 section
            if (data['unprotected-l4'] || data['protected-l4']) {
                const l4Section = document.createElement('div');
                l4Section.className = 'dstat-category';
                
                const l4Header = document.createElement('div');
                l4Header.className = 'category-header';
                l4Header.innerHTML = `
                    <div class="category-title">
                        <i class="fa-solid fa-network-wired"></i> ${translations[currentLang].l4dstats}
                    </div>
                    <a href="https://t.me/forenix56" target="_blank" class="add-dstat-btn">
                        <i class="fa-solid fa-plus me-1"></i> ${translations[currentLang].add_your_dstat}
                    </a>
                `;
                
                const l4Grid = document.createElement('div');
                l4Grid.className = 'dstat-grid';
                
                if (data['unprotected-l4']) {
                    data['unprotected-l4'].forEach(item => {
                        const btn = createDstatButton(item, 'l4', translations[currentLang].unprotected);
                        l4Grid.appendChild(btn);
                    });
                }
                
                if (data['protected-l4']) {
                    data['protected-l4'].forEach(item => {
                        const btn = createDstatButton(item, 'l4', translations[currentLang].protected);
                        l4Grid.appendChild(btn);
                    });
                }
                
                l4Section.appendChild(l4Header);
                l4Section.appendChild(l4Grid);
                container.appendChild(l4Section);
            }
            
            // Create L7 section
            if (data['unprotected-l7'] || data['protected-l7']) {
                const l7Section = document.createElement('div');
                l7Section.className = 'dstat-category';
                
                const l7Header = document.createElement('div');
                l7Header.className = 'category-header';
                l7Header.innerHTML = `
                    <div class="category-title">
                        <i class="fa-solid fa-globe"></i> ${translations[currentLang].l7dstats}
                    </div>
                    <a href="https://t.me/forenix56" target="_blank" class="add-dstat-btn">
                        <i class="fa-solid fa-plus me-1"></i> ${translations[currentLang].add_your_dstat}
                    </a>
                `;
                
                const l7Grid = document.createElement('div');
                l7Grid.className = 'dstat-grid';
                
                if (data['unprotected-l7']) {
                    data['unprotected-l7'].forEach(item => {
                        const btn = createDstatButton(item, 'l7', translations[currentLang].unprotected);
                        l7Grid.appendChild(btn);
                    });
                }
                
                if (data['protected-l7']) {
                    data['protected-l7'].forEach(item => {
                        const btn = createDstatButton(item, 'l7', translations[currentLang].protected);
                        l7Grid.appendChild(btn);
                    });
                }
                
                l7Section.appendChild(l7Header);
                l7Section.appendChild(l7Grid);
                container.appendChild(l7Section);
            }
        }

        function createDstatButton(item, mode, type) {
            const btn = document.createElement('a');
            btn.className = 'dstat-btn';
            btn.href = `/${mode}/${item.name}`;
            
            const countryCode = item.country && item.country !== 'Unknown' ? 
                item.country.toLowerCase() : 'us';
            
            btn.innerHTML = `
                <div class="dstat-flag">
                    <span class="fi fi-${countryCode}"></span>
                </div>
                <div class="dstat-btn-content">
                    <span class="dstat-name">${item.nickname}</span>
                    <span class="dstat-type">${type}</span>
                </div>
                <span class="dstat-badge">~${formatValue(mode, item.amount)}</span>
            `;
            
            return btn;
        }

        function refreshData() {
            showLoading(true);
            loadDstats();
            updateLastUpdated();
            
            // Hide loading after refresh completes
            setTimeout(() => {
                showLoading(false);
            }, 1000);
        }

        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = 
                translations[currentLang].last_updated + " " + now.toLocaleTimeString();
        }

        function showLoading(show) {
            const loadingBar = document.getElementById('loadingTopbar');
            if (loadingBar) {
                if (show) {
                    loadingBar.classList.add('active');
                } else {
                    loadingBar.classList.remove('active');
                }
            }
        }

        function showError(message) {
            document.getElementById('dstats-container').innerHTML = `
                <div class="error-message">
                    <i class="fa-solid fa-exclamation-triangle me-2"></i>${message}
                    <button class="btn btn-sm" onclick="refreshData()" style="background: var(--primary-color); color: white; border: none;">
                        <i class="fa-solid fa-rotate"></i> Retry
                    </button>
                </div>
            `;
        }

        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerText = message;
            container.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    container.removeChild(notification);
                }, 300);
            }, 5000);
        }

        // Utility functions
        function formatValue(mode, amount) {
            let formattedValue;

            if (mode === "l7") {
                if (amount >= 1000000) {
                    formattedValue = `${(amount / 1000000)}Mrs`;
                } else if (amount >= 1000) {
                    formattedValue = `${(amount / 1000)}Krs`;
                } else {
                    formattedValue = `${amount}RS`;
                }
            } else if (mode === "l4") {
                if (amount >= 1000000) {
                    formattedValue = `${(amount / 1000000)}Tbps`;
                } else if (amount >= 1000) {
                    formattedValue = `${(amount / 1000)}Gbps`;
                } else {
                    formattedValue = `${amount}Mbps`;
                }
            }

            return formattedValue;
        }

        function formatNumber(number) {
            const suffixes = ["", " thousand", " million", " billion"];
            const base = 1000;

            if (typeof number !== "number") {
                throw new Error("Input must be a number.");
            }

            const isNegative = number < 0;
            number = Math.abs(number);

            if (number < base) {
                return (isNegative ? "-" : "") + number.toString();
            }

            const suffixIndex = Math.floor(Math.log10(number) / 3);
            const scaledNumber = number / Math.pow(base, suffixIndex);
            const formattedNumber = scaledNumber.toFixed(2).replace(/\.0+$/, "");

            return (isNegative ? "-" : "") + formattedNumber + suffixes[suffixIndex];
        }

        function convertToBestUnit(kilobits) {
            const isNegative = kilobits < 0;
            kilobits = Math.abs(kilobits);

            if (kilobits >= 1024 * 1024) {
                const gigabits = kilobits / (1024 * 1024);
                return isNegative ? `-${gigabits.toFixed(2)} Gbps` : `${gigabits.toFixed(2)} Gbps`;
            } else if (kilobits >= 1024) {
                const megabits = kilobits / 1024;
                return isNegative ? `-${megabits.toFixed(2)} Mbps` : `${megabits.toFixed(2)} Mbps`;
            } else {
                if (kilobits >= 8) {
                    return isNegative ? `-${kilobits.toFixed(2)} kb` : `${kilobits.toFixed(2)} kb`;
                } else {
                    const kilobytes = kilobits / 8;
                    return isNegative ? `-${kilobytes.toFixed(2)} KB` : `${kilobytes.toFixed(2)} KB`;
                }
            }
        }

        function formatNumberDot(num) {
            let numStr = num.toString();
            let formatted = "";
              
            for (let i = 0; i < numStr.length; i++) {
                formatted = numStr[numStr.length - 1 - i] + formatted;
                if ((i + 1) % 3 === 0 && i + 1 !== numStr.length) {
                    formatted = "." + formatted;
                }
            }
              
            return formatted;
        }

        // Handle chart pages
        if(window.location.pathname.includes("l4/") || window.location.pathname.includes("l7/")) {
            document.getElementById('lastUpdated').style.display = 'none';
            initializeChartPage();
        }

        function initializeChartPage() {
            document.getElementById('myChart').style.display = 'block';
            document.getElementById('dstats-container').style.display = 'none';
            document.getElementById('searchInput').style.display = 'none';
            document.getElementById('searchContainer').style.display = 'none';
            
            let type, name;
            
            if(window.location.pathname.includes("l4/")) {
                document.getElementById('l4').classList.add('active');
                type = "l4";
                name = window.location.pathname.split("l4/")[1];
            } else if(window.location.pathname.includes("l7/")) {
                document.getElementById('l7').classList.add('active');
                type = "l7";
                name = window.location.pathname.split("l7/")[1];
            }
            
            if (type === "l4") {
                initializeL4Chart(name);
            } else if (type === "l7") {
                initializeL7Chart(name);
            }
        }

        function initializeL4Chart(name) {
            const ctx = document.getElementById('myChart').getContext('2d');
            
            // Start with just bandwidth dataset
            const datasets = [{
                label: translations[currentLang].totalbandwidth,
                fill: true,
                borderColor: '#6c757c',
                tension: 0.05,
                data: []
            }];

            const dstatChart = new Chart("myChart", {
                type: "line",
                data: {
                    labels: Array(60).fill(""),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        display: false
                    },
                    interaction: {
                        intersect: false
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (`${context.dataset.label}`.includes(translations[currentLang].totalbandwidth)) {
                                            label += convertToBestUnit(context.parsed.y);
                                        } else {
                                            label += formatNumber(context.parsed.y);
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value, index, values) {
                                    return convertToBestUnit(value);
                                },
                            },
                        },
                    }
                }
            });

            // Load initial Dstat data
            fetch('https://api.dstat.one/', {
                method: 'POST',
                body: JSON.stringify({
                    "name": name,
                    "type": "l4"
                }),
            }).then(async (response) => {
                var json = await response.json();
                if(response.status === 200 && !json.err) {
                    if(json.tip === null) {
                        document.getElementById("text").innerHTML = `<h5 class="mb-1" style="color:white;font-size: large;">${json.nickname} <span class="dstat-badge" style="border:none;background-color:var(--content-bg);padding:0px 0px 0px 0px;font-size:0.85em;">~${formatValue("l4", json.bandwidth)}</span><br>IP: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('ip');" id="ip">${json.hit}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('ip');"></i> & Port: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('port');" id="port">${json.port}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('port');"></i></h5>`;
                    } else {
                        document.getElementById("text").innerHTML = `<h5 class="mb-1" style="color:white;font-size: large;">${json.nickname} <span class="dstat-badge" style="border:none;background-color:var(--content-bg);padding:0px 0px 0px 0px;font-size:0.85em;">~${formatValue("l4", json.bandwidth)}<br>IP: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('ip');" id="ip">${json.hit}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('ip');"></i> & Port: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('port');" id="port">${json.port}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('port');"></i><br>${json.tip}</h5>`;
                    }
                } else {
                    document.getElementById("chart-background").style.display = "none";
                    throw new Error(json.err || 'Dstat not found');
                }
            }).catch(error => {
                console.error('Error loading Dstat:', error);
                showChartError(error.message);
            });

            // Update Dstat info every 5 seconds
            const infoInterval = setInterval(() => {
                fetch('https://api.dstat.one/', {
                    method: 'POST',
                    body: JSON.stringify({
                        "name": name,
                        "type": "l4"
                    }),
                }).then(async (response) => {
                    var json = await response.json();
                    if(response.status === 200 && !json.err) {
                        if(json.tip === null) {
                            document.getElementById("text").innerHTML = `<h5 class="mb-1" style="color:white;font-size: large;">${json.nickname} <span class="dstat-badge" style="border:none;background-color:var(--content-bg);padding:0px 0px 0px 0px;font-size:0.85em;">~${formatValue("l4", json.bandwidth)}</span><br>IP: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('ip');" id="ip">${json.hit}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('ip');"></i> & Port: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('port');" id="port">${json.port}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('port');"></i></h5>`;
                        } else {
                            document.getElementById("text").innerHTML = `<h5 class="mb-1" style="color:white;font-size: large;">${json.nickname} <span class="dstat-badge" style="border:none;background-color:var(--content-bg);padding:0px 0px 0px 0px;font-size:0.85em;">~${formatValue("l4", json.bandwidth)}<br>IP: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('ip');" id="ip">${json.hit}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('ip');"></i> & Port: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('port');" id="port">${json.port}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('port');"></i><br>${json.tip}</h5>`;
                        }
                    } else {
                        document.getElementById("chart-background").style.display = "none";
                        throw new Error(json.err || 'Dstat not found');
                    }
                }).catch(error => {
                    console.error('Error updating Dstat info:', error);
                    clearInterval(infoInterval);
                    clearInterval(statsInterval);
                    showChartError(error.message);
                });
            }, 5000);

            // Load initial chart data
            fetch('https://api.dstat.one/stats', {
                method: 'POST',
                body: JSON.stringify({
                    "name": name,
                    "type": "l4"
                }),
            }).then(async (response) => {
                var json = await response.json();
                if(response.status === 200 && json.mbits) {
                    // Add packets dataset if available
                    if (json.pps && json.pps.length > 0) {
                        dstatChart.data.datasets.push({
                            label: translations[currentLang].totalpackets,
                            fill: true,
                            borderColor: '#949fa8',
                            tension: 0.05,
                            data: json.pps.slice(0, 60)
                        });
                    }
                    
                    // Add connections dataset if available
                    if (json.conns && json.conns.length > 0) {
                        dstatChart.data.datasets.push({
                            label: translations[currentLang].activeconns,
                            fill: true,
                            tension: 0.05,
                            borderColor: '#c2cdd6',
                            data: json.conns.slice(0, 60)
                        });
                    }
                    
                    // Set bandwidth data
                    dstatChart.data.datasets[0].data = json.mbits.slice(0, 60);
                    dstatChart.update();
                } else {
                    throw new Error(json.err || 'Failed to load chart data');
                }
            }).catch(error => {
                console.error('Error loading chart data:', error);
                showChartError(error.message);
            });

            // Update chart data every 1.5 seconds
            const statsInterval = setInterval(async () => {
                fetch('https://api.dstat.one/stats', {
                    method: 'POST',
                    body: JSON.stringify({
                        "name": name,
                        "type": "l4"
                    }),
                }).then(async (response) => {
                    var json = await response.json();
                    if(response.status === 200 && json.mbits) {
                        // Update bandwidth data
                        if(dstatChart.data.datasets[0].data.length >= 60) {
                            dstatChart.data.datasets[0].data.shift();
                            dstatChart.data.datasets[0].data.push(json.mbits[json.mbits.length-1]);
                        } else {
                            dstatChart.data.datasets[0].data = json.mbits.slice(0, 60);
                        }
                        
                        // Update packets data if available
                        if (json.pps && dstatChart.data.datasets[1]) {
                            if(dstatChart.data.datasets[1].data.length >= 60) {
                                dstatChart.data.datasets[1].data.shift();
                                dstatChart.data.datasets[1].data.push(json.pps[json.pps.length-1]);
                            } else {
                                dstatChart.data.datasets[1].data = json.pps.slice(0, 60);
                            }
                        }
                        
                        // Update connections data if available
                        if (json.conns && dstatChart.data.datasets[2]) {
                            if(dstatChart.data.datasets[2].data.length >= 60) {
                                dstatChart.data.datasets[2].data.shift();
                                dstatChart.data.datasets[2].data.push(json.conns[json.conns.length-1]);
                            } else {
                                dstatChart.data.datasets[2].data = json.conns.slice(0, 60);
                            }
                        }
                        
                        dstatChart.update();
                    } else {
                        throw new Error(json.err || 'Failed to update chart data');
                    }
                }).catch(error => {
                    console.error('Error updating chart data:', error);
                    clearInterval(statsInterval);
                    showChartError(error.message);
                });
            }, 1500);
        }

    function initializeL7Chart(name) {
        const ctx = document.getElementById('myChart').getContext('2d');
        
        // Start with just requests dataset
        const datasets = [{
            label: translations[currentLang].totalrequests,
            fill: true,
            borderColor: '#6c757c',
            tension: 0.05,
            data: []
        }];

        const dstatChart = new Chart("myChart", {
            type: "line",
            data: {
                labels: Array(60).fill(""),
                datasets: datasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    display: false
                },
                interaction: {
                    intersect: false
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                let label = context.dataset.label || '';

                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    if (`${context.dataset.label}`.includes(translations[currentLang].totalbandwidth)) {
                                        label += convertToBestUnit(context.parsed.y);
                                    } else {
                                        label += formatNumberDot(context.parsed.y);
                                    }
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function (value, index, values) {
                                return formatNumberDot(value);
                            },
                        },
                    },
                }
            }
        });

        // Load initial Dstat data
        fetch('https://api.dstat.one/', {
            method: 'POST',
            body: JSON.stringify({
                "name": name,
                "type": "l7"
            }),
        }).then(async (response) => {
            var json = await response.json();
            if(response.status === 200 && !json.err) {
                if(json.tip === null) {
                    document.getElementById("text").innerHTML = `<h5 class="mb-1" style="color:white;font-size: large;">${json.nickname} <span class="dstat-badge" style="border:none;background-color:var(--content-bg);padding:0px 0px 0px 0px;font-size:0.85em;">~${formatValue("l7", json.requests)}<br>${translations[currentLang].url}: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('url');" id="url">${json.hit}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('url');"></i></h5>`;
                } else {
                    document.getElementById("text").innerHTML = `<h5 class="mb-1" style="color:white;font-size: large;">${json.nickname} <span class="dstat-badge" style="border:none;background-color:var(--content-bg);padding:0px 0px 0px 0px;font-size:0.85em;">~${formatValue("l7", json.requests)}<br>${translations[currentLang].url}: <a style="color:var(--secondary-color);cursor: pointer;text-decoration: underline;" onclick="copy('url');" id="url">${json.hit}</a> <i class="fa-solid fa-copy" style="color:var(--secondary-color);cursor: pointer;" onclick="copy('url');"></i><br>${json.tip}</h5>`;
                }
            } else {
                document.getElementById("chart-background").style.display = "none";
                throw new Error(json.err || 'Dstat not found');
            }
        }).catch(error => {
            console.error('Error loading Dstat:', error);
            showChartError(error.message);
        });

        // Load initial chart data
        fetch('https://api.dstat.one/stats', {
            method: 'POST',
            body: JSON.stringify({
                "name": name,
                "type": "l7"
            }),
        }).then(async (response) => {
            var json = await response.json();
            if(response.status === 200 && json.reqs) {
                // Add connections dataset if available
                if (json.conns && json.conns.length > 0) {
                    dstatChart.data.datasets.push({
                        label: translations[currentLang].activeconns,
                        fill: true,
                        tension: 0.05,
                        borderColor: '#949fa8',
                        data: json.conns.slice(0, 60)
                    });
                }
                
                // Set requests data
                dstatChart.data.datasets[0].data = json.reqs.slice(0, 60);
                dstatChart.update();
            } else {
                throw new Error(json.err || 'Failed to load chart data');
            }
        }).catch(error => {
            console.error('Error loading chart data:', error);
            showChartError(error.message);
        });

        // Update chart data every 1.5 seconds
        const statsInterval = setInterval(async () => {
            fetch('https://api.dstat.one/stats', {
                method: 'POST',
                body: JSON.stringify({
                    "name": name,
                    "type": "l7"
                }),
            }).then(async (response) => {
                var json = await response.json();
                if(response.status === 200 && json.reqs) {
                    // Update requests data
                    if(dstatChart.data.datasets[0].data.length >= 60) {
                        dstatChart.data.datasets[0].data.shift();
                        dstatChart.data.datasets[0].data.push(json.reqs[json.reqs.length-1]);
                    } else {
                        dstatChart.data.datasets[0].data = json.reqs.slice(0, 60);
                    }
                    
                    // Update connections data if available
                    if (json.conns && dstatChart.data.datasets[1]) {
                        if(dstatChart.data.datasets[1].data.length >= 60) {
                            dstatChart.data.datasets[1].data.shift();
                            dstatChart.data.datasets[1].data.push(json.conns[json.conns.length-1]);
                        } else {
                            dstatChart.data.datasets[1].data = json.conns.slice(0, 60);
                        }
                    }
                    
                    dstatChart.update();
                } else {
                    throw new Error(json.err || 'Failed to update chart data');
                }
            }).catch(error => {
                console.error('Error updating chart data:', error);
                clearInterval(statsInterval);
                showChartError(error.message);
            });
        }, 1500);
    }

    // Add this error handling function
    function showChartError(message) {
        document.getElementById("text").innerHTML = `
            <div class="error-message">
                <i class="fa-solid fa-exclamation-triangle me-1"></i>${message}
                <br><br>
                <button class="btn btn-sm mt-2" onclick="window.location.href='/' style="background: var(--primary-color); color: white; border: none;">
                    <i class="fa-solid fa-arrow-left me-2"></i>Back to Dstats
                </button>
                <button class="btn btn-sm mt-2" onclick="location.reload()" style="background: var(--accent-color); color: white; border: none; margin-left: 10px;">
                    <i class="fa-solid fa-rotate me-2"></i>Retry
                </button>
            </div>
        `;
        document.getElementById('myChart').style.display = 'none';
    }

        // Confetti functionality
        let ratelimit = 0;
        document.querySelector('.logo').addEventListener('click', function() {
            if(ratelimit === 0) {
                ratelimit = 1;
                setTimeout(() => {
                    ratelimit = 0;
                }, 15000);
                
                function fireConfetti() {
                    confetti({
                        particleCount: 300,
                        spread: 160,
                        startVelocity: 60,
                        origin: { 
                            x: Math.random(),
                            y: Math.random() * 0.5 + 0.2
                        },
                        colors: ['#4a6fa5', '#6d8cc5', '#1e3a8a', '#1a1d23', '#ffffff']
                    });
                }
            
                for (let i = 0; i < 5; i++) {
                    setTimeout(fireConfetti, i * 300);
                }
            } else {
                showNotification("Confetti is on a cooldown for 15 seconds.", "failed")
            }
        });

        // Copy functionality
        function copy(id) {
            let copy = document.getElementById(id);
            navigator.clipboard.writeText(copy.innerText);
            showNotification(translations[currentLang].copied, "success");
        }

        // Dropdown functionality
        document.querySelectorAll('.dropdown').forEach(dropdown => {
            dropdown.addEventListener('click', (e) => {
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                } else {
                    document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('show'));
                    dropdown.classList.add('show');
                }
            });
            
            dropdown.addEventListener('mouseenter', () => {
                dropdown.classList.add('show');
            });
            
            dropdown.addEventListener('mouseleave', () => {
                if (!dropdown.querySelector('.dropdown-menu:hover')) {
                    dropdown.classList.remove('show');
                }
            });
            
            dropdown.querySelector('.dropdown-menu')?.addEventListener('mouseleave', () => {
                dropdown.classList.remove('show');
            });
        });
    </script>
</body>
</html>